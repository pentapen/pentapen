!function(a,b){"function"==typeof define&&define.amd?define("p5.play",["p5"],function(a){b(a)}):b("object"==typeof exports?require("../p5"):a.p5)}(this,function(a){function b(b,c){Object.defineProperty(a.prototype,b,{configurable:!0,enumerable:!0,get:function(){var d=this instanceof a&&!this._isGlobal?this:window;return void 0===d._p5PlayProperties&&(d._p5PlayProperties={}),b in d._p5PlayProperties||(d._p5PlayProperties[b]=c.call(d)),d._p5PlayProperties[b]}})}function c(a){if("function"!=typeof a)throw new Error("constructor must be a function");return function(){function d(){var b=Array.prototype.slice.call(arguments);return a.apply(this,[c].concat(b))}var c=this;return d.prototype=a.prototype,d}}function d(a){return function(c){var d=a[c];if("function"!=typeof d)throw new Error('"'+c+'" is not a p5 method');return d.bind(a)}}function o(b,c,k,l,m){var n=d(b),p=n("createVector"),q=n("color"),r=n("random"),s=n("print"),w=n("push"),y=n("pop"),z=n("colorMode"),A=n("noStroke"),B=n("rectMode"),C=n("ellipseMode"),D=n("imageMode"),E=n("translate"),F=n("scale"),G=n("rotate"),H=n("stroke"),I=n("strokeWeight"),J=n("line"),K=n("noFill"),L=n("fill"),M=n("textAlign"),N=n("textSize"),O=n("text"),P=n("rect"),Q=n("cos"),R=n("sin"),S=n("atan2"),T=b.quadTree,U=b.camera,V=a.prototype.RGB,W=a.prototype.CENTER,X=a.prototype.LEFT,Y=a.prototype.BOTTOM;this.position=p(c,k),this.previousPosition=p(c,k),this.newPosition=p(c,k),this.deltaX=0,this.deltaY=0,this.velocity=p(0,0),this.maxSpeed=-1,this.friction=1,this.collider=void 0,this.colliderType="none",this.touching={},this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1,this.mass=1,this.immovable=!1,this.restitution=1,Object.defineProperty(this,"rotation",{enumerable:!0,get:function(){return this._rotation},set:function(a){this._rotation=a,this.rotateToDirection&&this.setSpeed(this.getSpeed(),a)}}),this._rotation=0,this.rotationSpeed=0,this.rotateToDirection=!1,this.depth=0,this.scale=1;var Z=1,$=1;this.visible=!0,this.mouseActive=!1,this.mouseIsOver=!1,this.mouseIsPressed=!1,this._internalWidth=l,this._internalHeight=m,Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return this._internalWidth},set:function(a){this._internalWidth=a}}),this.width=void 0===l?100:l,Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return this._internalHeight},set:function(a){this._internalHeight=a}}),this.height=void 0===m?100:m,this.originalWidth=this._internalWidth,this.originalHeight=this._internalHeight,this.removed=!1,this.life=-1,this.debug=!1,this.shapeColor=q(r(255),r(255),r(255)),this.groups=[];var _={},aa="";this.animation=void 0,this._syncAnimationSizes=function(){"default"===this.colliderType&&1!==_[aa].getWidth()&&1!==_[aa].getHeight()&&(this.collider=this.getBoundingBox(),this.colliderType="image",this._internalWidth=_[aa].getWidth()*e(this._getScaleX()),this._internalHeight=_[aa].getHeight()*e(this._getScaleY())),(_[aa].frameChanged||void 0===this.width||void 0===this.height)&&(this._internalWidth=_[aa].getWidth()*e(this._getScaleX()),this._internalHeight=_[aa].getHeight()*e(this._getScaleY()))},this.update=function(){if(!this.removed){if(this.newPosition!==this.position?this.previousPosition=p(this.newPosition.x,this.newPosition.y):this.previousPosition=p(this.position.x,this.position.y),this.velocity.x*=this.friction,this.velocity.y*=this.friction,-1!==this.maxSpeed&&this.limitSpeed(this.maxSpeed),this.rotateToDirection&&this.velocity.mag()>0&&(this._rotation=this.getDirection()),this.rotation+=this.rotationSpeed,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.newPosition=p(this.position.x,this.position.y),this.deltaX=this.position.x-this.previousPosition.x,this.deltaY=this.position.y-this.previousPosition.y,_[aa]&&(_[aa].update(),this._syncAnimationSizes()),this.collider){if(this.collider instanceof u){var a;a=b._angleMode===b.RADIANS?f(this.rotation):this.rotation,"custom"===this.colliderType?(this.collider.extents.x=this.collider.originalExtents.x*e(this._getScaleX())*e(Q(a))+this.collider.originalExtents.y*e(this._getScaleY())*e(R(a)),this.collider.extents.y=this.collider.originalExtents.x*e(this._getScaleX())*e(R(a))+this.collider.originalExtents.y*e(this._getScaleY())*e(Q(a))):"default"===this.colliderType?(this.collider.extents.x=this._internalWidth*e(this._getScaleX())*e(Q(a))+this._internalHeight*e(this._getScaleY())*e(R(a)),this.collider.extents.y=this._internalWidth*e(this._getScaleX())*e(R(a))+this._internalHeight*e(this._getScaleY())*e(Q(a))):"image"===this.colliderType&&(this.collider.extents.x=this._internalWidth*e(Q(a))+this._internalHeight*e(R(a)),this.collider.extents.y=this._internalWidth*e(R(a))+this._internalHeight*e(Q(a)))}this.collider instanceof t&&(this.collider.radius=this.collider.originalRadius*e(this.scale))}this.mouseActive?(this.collider||this.setDefaultCollider(),this.mouseUpdate()):"function"!=typeof this.onMouseOver&&"function"!=typeof this.onMouseOut&&"function"!=typeof this.onMousePressed&&"function"!=typeof this.onMouseReleased||(this.mouseActive=!0,this.collider||this.setDefaultCollider(),this.mouseUpdate()),this.life>0&&this.life--,0===this.life&&this.remove()}},this.setDefaultCollider=function(){_[aa]&&1!==_[aa].getWidth()&&1!==_[aa].getHeight()?(this.collider=this.getBoundingBox(),this._internalWidth=_[aa].getWidth()*e(this._getScaleX()),this._internalHeight=_[aa].getHeight()*e(this._getScaleY()),this.colliderType="image"):_[aa]&&1===_[aa].getWidth()&&1===_[aa].getHeight()||(this.collider=new u(b,this.position,p(this._internalWidth,this._internalHeight)),this.colliderType="default"),b.quadTree.insert(this)},this.mouseUpdate=function(){var a=this.mouseIsOver,c=this.mouseIsPressed;this.mouseIsOver=!1,this.mouseIsPressed=!1;var d;d=U.active?p(U.mouseX,U.mouseY):p(b.mouseX,b.mouseY),this.collider&&(this.collider instanceof t?g(d.x,d.y,this.collider.center.x,this.collider.center.y)<this.collider.radius&&(this.mouseIsOver=!0):this.collider instanceof u&&d.x>this.collider.left()&&d.y>this.collider.top()&&d.x<this.collider.right()&&d.y<this.collider.bottom()&&(this.mouseIsOver=!0),this.mouseIsOver&&b.mouseIsPressed&&(this.mouseIsPressed=!0),!a&&this.mouseIsOver&&void 0!==this.onMouseOver&&("function"==typeof this.onMouseOver?this.onMouseOver.call(this,this):s("Warning: onMouseOver should be a function")),a&&!this.mouseIsOver&&void 0!==this.onMouseOut&&("function"==typeof this.onMouseOut?this.onMouseOut.call(this,this):s("Warning: onMouseOut should be a function")),!c&&this.mouseIsPressed&&void 0!==this.onMousePressed&&("function"==typeof this.onMousePressed?this.onMousePressed.call(this,this):s("Warning: onMousePressed should be a function")),!c||b.mouseIsPressed||this.mouseIsPressed||void 0===this.onMouseReleased||("function"==typeof this.onMouseReleased?this.onMouseReleased.call(this,this):s("Warning: onMouseReleased should be a function")))},this.setCollider=function(a,c,d,e,f){this.colliderType="custom";var g=p(c,d);"rectangle"===a&&5===arguments.length?this.collider=new u(b,this.position,p(e,f),g):"circle"===a&&(4!==arguments.length&&s('Warning: usage setCollider("circle", offsetX, offsetY, radius)'),this.collider=new t(b,this.position,e,g)),T.insert(this)},this.getBoundingBox=function(){var a=_[aa].getWidth()*e(this._getScaleX()),c=_[aa].getHeight()*e(this._getScaleY());return new u(b,this.position,p(a,c))},this.mirrorX=function(a){if(1!==a&&-1!==a)return Z;Z=a},this.mirrorY=function(a){if(1!==a&&-1!==a)return $;$=a},this._getScaleX=function(){return this.scale},this._getScaleY=function(){return this.scale},this.display=function(){this.visible&&!this.removed&&(w(),z(V),A(),B(W),C(W),D(W),E(this.position.x,this.position.y),F(this._getScaleX()*Z,this._getScaleY()*$),G(b._angleMode===b.RADIANS?f(this.rotation):this.rotation),this.draw(),y(),this.debug&&(w(),H(0,255,0),I(1),J(this.position.x-10,this.position.y,this.position.x+10,this.position.y),J(this.position.x,this.position.y-10,this.position.x,this.position.y+10),K(),A(),L(0,255,0),M(X,Y),N(16),O(this.depth+"",this.position.x+4,this.position.y-2),K(),H(0,255,0),void 0!==this.collider&&this.collider.draw(),y()))},this.draw=function(){""!==aa&&_?_[aa]&&_[aa].draw(0,0,0):(A(),L(this.shapeColor),P(0,0,this._internalWidth,this._internalHeight))},this.remove=function(){for(this.removed=!0,T.removeObject(this);this.groups.length>0;)this.groups[0].remove(this)},this.setVelocity=function(a,b){this.velocity.x=a,this.velocity.y=b},this.getSpeed=function(){return this.velocity.mag()},this.getDirection=function(){var a=S(this.velocity.y,this.velocity.x);return isNaN(a)&&(a=0),b._angleMode===b.RADIANS&&(a=h(a)),a},this.addToGroup=function(a){a instanceof Array?a.add(this):s("addToGroup error: "+a+" is not a group")},this.limitSpeed=function(a){var b=this.getSpeed();if(e(b)>a){var c=a/e(b);this.velocity.x*=c,this.velocity.y*=c}},this.setSpeed=function(a,c){var d;d=void 0===c?0!==this.velocity.x||0!==this.velocity.y?b.atan2(this.velocity.y,this.velocity.x):b._angleMode===b.RADIANS?f(this._rotation):this._rotation:b._angleMode===b.RADIANS?f(c):c,this.velocity.x=Q(d)*a,this.velocity.y=R(d)*a},this.addSpeed=function(a,c){var d;d=b._angleMode===b.RADIANS?f(c):c,this.velocity.x+=Q(d)*a,this.velocity.y+=R(d)*a},this.attractionPoint=function(a,b,c){var d=S(c-this.position.y,b-this.position.x);this.velocity.x+=Q(d)*a,this.velocity.y+=R(d)*a},this.addImage=function(){if("string"==typeof arguments[0]&&arguments[1]instanceof a.Image)this.addAnimation(arguments[0],arguments[1]);else{if(!(arguments[0]instanceof a.Image))throw"addImage error: allowed usages are <image> or <label>, <image>";this.addAnimation("normal",arguments[0])}},this.addAnimation=function(a){var c;if("string"!=typeof a)return s("Sprite.addAnimation error: the first argument must be a label (String)"),-1;if(arguments.length<2)return s("addAnimation error: you must specify a label and n frame images"),-1;if(arguments[1]instanceof v){var d=arguments[1],f=d.clone();return _[a]=f,""===aa&&(aa=a,this.animation=f),f.isSpriteAnimation=!0,this._internalWidth=f.getWidth()*e(this._getScaleX()),this._internalHeight=f.getHeight()*e(this._getScaleY()),f}for(var g=[],h=1;h<arguments.length;h++)g.push(arguments[h]);return c=x(b.Animation,g),_[a]=c,""===aa&&(aa=a,this.animation=c),c.isSpriteAnimation=!0,this._internalWidth=c.getWidth()*e(this._getScaleX()),this._internalHeight=c.getHeight()*e(this._getScaleY()),c},this.changeImage=function(a){this.changeAnimation(a)},this.getAnimationLabel=function(){return aa},this.changeAnimation=function(a){_[a]?(aa=a,this.animation=_[a]):s("changeAnimation error: no animation labeled "+a)},this.overlapPixel=function(a,b){var c=p(a,b),d=this.animation.getFrameImage();if(c.x-=this.position.x-d.width/2,c.y-=this.position.y-d.height/2,c.x<0||c.x>d.width||c.y<0||c.y>d.height)return!1;if(0===this.rotation&&1===this.scale){return 255===d.get(c.x,c.y)[3]}return s("Error: overlapPixel doesn't work with scaled or rotated sprites yet"),!1},this.overlapPoint=function(a,b){var c=p(a,b);if(this.collider||this.setDefaultCollider(),void 0!==this.collider){if(this.collider instanceof u)return c.x>this.collider.left()&&c.x<this.collider.right()&&c.y>this.collider.top()&&c.y<this.collider.bottom();if(this.collider instanceof t){var d=this.collider.radius*this.collider.radius;return i(this.collider.center.x-c.x,2)+i(this.collider.center.y-c.y,2)<d}return!1}return!1},this.overlap=function(a,b){return this.AABBops("overlap",a,b)},this.collide=function(a,b){return this.AABBops("collide",a,b)},this.displace=function(a,b){return this.AABBops("displace",a,b)},this.bounce=function(a,b){return this.AABBops("bounce",a,b)},this.AABBops=function(c,d,f){this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1;var g=!1,h=[];if(d instanceof o)h.push(d);else{if(!(d instanceof Array))throw"Error: overlap can only be checked between sprites or groups";void 0!==T&&T.active&&(h=T.retrieveFromGroup(this,d)),0===h.length&&(h=d)}for(var i=0;i<h.length;i++)if(this!==h[i]&&!this.removed){var k,l=h[i];if(void 0===this.collider&&this.setDefaultCollider(),void 0===l.collider&&l.setDefaultCollider(),void 0!==this.collider&&void 0!==l.collider)if("overlap"===c){var m;m=this.collider instanceof t?l.collider.overlap(this.collider):this.collider.overlap(l.collider),m&&(g=!0,void 0!==f&&"function"==typeof f&&f.call(this,this,l))}else if("collide"===c||"bounce"===c){k=p(0,0);var n=e(this.velocity.x-l.velocity.x)>=l.collider.extents.x/2&&0===j(this.deltaX-this.velocity.x),q=e(this.velocity.y-l.velocity.y)>=l.collider.size().y/2&&0===j(this.deltaY-this.velocity.y);if(n||q){var r=p((this.position.x+this.previousPosition.x)/2,(this.position.y+this.previousPosition.y)/2),s=p(e(this.position.x-this.previousPosition.x)+this.collider.extents.x,e(this.position.y-this.previousPosition.y)+this.collider.extents.y),v=new u(b,r,s,this.collider.offset);v.overlap(l.collider)&&(n&&(this.velocity.x<0?k.x=l.collider.right()-this.collider.left()+1:this.velocity.x>0&&(k.x=l.collider.left()-this.collider.right()-1)),q&&(this.velocity.y>0?k.y=l.collider.top()-this.collider.bottom()-1:this.velocity.y<0&&(k.y=l.collider.bottom()-this.collider.top()+1)))}else k=this.collider instanceof t?l.collider.collide(this.collider).mult(-1):this.collider.collide(l.collider);if(0!==k.x||0!==k.y){var w,x,y,z;if(this.immovable||(this.position.add(k),this.previousPosition=p(this.position.x,this.position.y),this.newPosition=p(this.position.x,this.position.y)),k.x>0&&(this.touching.left=!0),k.x<0&&(this.touching.right=!0),k.y<0&&(this.touching.bottom=!0),k.y>0&&(this.touching.top=!0),"bounce"===c)if(this.collider instanceof t&&l.collider instanceof t){var A=a.Vector.sub(this.position,l.position),B=a.Vector.sub(l.position,this.position),C=A.magSq(),D=this.mass+l.mass,E=0,F=0;this.immovable?F=2:l.immovable?E=2:(E=2*l.mass/D,F=2*this.mass/D);var G=A.mult(E*a.Vector.sub(this.velocity,l.velocity).dot(A)/C),H=B.mult(F*a.Vector.sub(l.velocity,this.velocity).dot(B)/C);this.velocity.sub(G.mult(this.restitution)),l.velocity.sub(H.mult(l.restitution))}else l.immovable?(w=-this.velocity.x+l.velocity.x,x=-this.velocity.y+l.velocity.y):(w=(this.velocity.x*(this.mass-l.mass)+2*l.mass*l.velocity.x)/(this.mass+l.mass),x=(this.velocity.y*(this.mass-l.mass)+2*l.mass*l.velocity.y)/(this.mass+l.mass),y=(l.velocity.x*(l.mass-this.mass)+2*this.mass*this.velocity.x)/(this.mass+l.mass),z=(l.velocity.y*(l.mass-this.mass)+2*this.mass*this.velocity.y)/(this.mass+l.mass)),e(k.x)>e(k.y)&&(this.immovable||(this.velocity.x=w*this.restitution),l.immovable||(l.velocity.x=y*l.restitution)),e(k.x)<e(k.y)&&(this.immovable||(this.velocity.y=x*this.restitution),l.immovable||(l.velocity.y=z*l.restitution));void 0!==f&&"function"==typeof f&&f.call(this,this,l),g=!0}}else"displace"===c&&(k=this.collider instanceof t?l.collider.collide(this.collider).mult(-1):this.collider.collide(l.collider),0===k.x&&0===k.y||(l.position.sub(k),k.x>0&&(this.touching.left=!0),k.x<0&&(this.touching.right=!0),k.y<0&&(this.touching.bottom=!0),k.y>0&&(this.touching.top=!0),void 0!==f&&"function"==typeof f&&f.call(this,this,l),g=!0))}return g}}function p(a,b,c,d){this.position=a.createVector(b,c),this.zoom=d,this.mouseX=a.mouseX,this.mouseY=a.mouseY,this.active=!1,this.on=function(){this.active||(q.call(a),this.active=!0)},this.off=function(){this.active&&(r.call(a),this.active=!1)}}function q(){var a=this,b=a.camera;b.init||0!==b.position.x||0!==b.position.y||(b.position.x=a.width/2,b.position.y=a.height/2,b.init=!0),b.mouseX=a.mouseX+b.position.x-a.width/2,b.mouseY=a.mouseY+b.position.y-a.height/2,b.active||(b.active=!0,a.push(),a.scale(b.zoom),a.translate(-b.position.x+a.width/2/b.zoom,-b.position.y+a.height/2/b.zoom))}function r(){var a=this;a.camera.active&&(a.pop(),a.camera.active=!1)}function s(){function b(a,b){return null===a||null===b?null===a&&null===b:"string"==typeof a?a===b:"object"!=typeof a?a===b:a.equals instanceof Function?a.equals(b):a===b}function c(a,b,c){for(var d=!1,e=0;e<this.size();e++)d=this.get(e).AABBops(a,b,c)||d;return d}var a=[];return a.get=function(b){return a[b]},a.contains=function(a){return this.indexOf(a)>-1},a.indexOf=function(c){for(var d=0,e=a.length;d<e;++d)if(b(c,a[d]))return d;return-1},a.add=function(b){if(!(b instanceof o))throw"Error: you can only add sprites to a group";-1===this.indexOf(b)&&(a.push(b),b.groups.push(this))},a.size=function(){return a.length},a.removeSprites=function(){for(;a.length>0;)a[0].remove()},a.clear=function(){a.length=0},a.remove=function(b){if(!(b instanceof o))throw"Error: you can only remove sprites from a group";var c,d=!1;for(c=a.length-1;c>=0;c--)a[c]===b&&(a.splice(c,1),d=!0);if(d)for(c=b.groups.length-1;c>=0;c--)b.groups[c]===this&&b.groups.splice(c,1);return d},a.toArray=function(){return a.slice(0)},a.maxDepth=function(){return 0===a.length?0:a.reduce(function(a,b){return Math.max(a,b.depth)},-1/0)},a.minDepth=function(){return 0===a.length?99999:a.reduce(function(a,b){return Math.min(a,b.depth)},1/0)},a.draw=function(){this.sort(function(a,b){return a.depth-b.depth});for(var a=0;a<this.size();a++)this.get(a).display()},a.overlap=c.bind(a,"overlap"),a.collide=c.bind(a,"collide"),a.displace=c.bind(a,"displace"),a.bounce=c.bind(a,"bounce"),a}function t(b,c,f,h){var j=d(b),k=j("createVector"),l=a.prototype.CENTER;this.center=c,this.radius=f,this.originalRadius=f,this.offset=void 0===h?k(0,0):h,this.extents=k(2*f,2*f),this.draw=function(){b.noFill(),b.stroke(0,255,0),b.rectMode(l),b.ellipse(this.center.x+this.offset.x,this.center.y+this.offset.y,2*this.radius,2*this.radius)},this.overlap=function(a){var b=this.radius+a.radius;return(b*=b)>i(this.center.x-a.center.x,2)+i(this.center.y-a.center.y,2)},this.collide=function(a){if(this.overlap(a)){var c=b.atan2(this.center.y-a.center.y,this.center.x-a.center.x),d=this.radius+a.radius,f=e(d-g(this.center.x,this.center.y,a.center.x,a.center.y));return k(b.cos(c)*f,b.sin(c)*f)}return k(0,0)},this.size=function(){return k(2*this.radius,2*this.radius)},this.left=function(){return this.center.x+this.offset.x-this.radius},this.right=function(){return this.center.x+this.offset.x+this.radius},this.top=function(){return this.center.y+this.offset.y-this.radius},this.bottom=function(){return this.center.y+this.offset.y+this.radius}}function u(b,c,g,h){var i=d(b),j=i("createVector"),k=a.prototype.CENTER,l=a.prototype.PI;this.center=c,this.extents=g,this.originalExtents=g.copy(),this.offset=void 0===h?j(0,0):h,this.min=function(){return j(this.center.x+this.offset.x-this.extents.x,this.center.y+this.offset.y-this.extents.y)},this.max=function(){return j(this.center.x+this.offset.x+this.extents.x,this.center.y+this.offset.y+this.extents.y)},this.right=function(){return this.center.x+this.offset.x+this.extents.x/2},this.left=function(){return this.center.x+this.offset.x-this.extents.x/2},this.top=function(){return this.center.y+this.offset.y-this.extents.y/2},this.bottom=function(){return this.center.y+this.offset.y+this.extents.y/2},this.size=function(){return j(2*this.extents.x,2*this.extents.y)},this.rotate=function(a){var c;c=b._angleMode===b.RADIANS?f(a):a;var d=this.extents.x*e(b.cos(c))+this.extents.y*e(b.sin(c)),g=this.extents.x*e(b.sin(c))+this.extents.y*e(b.cos(c));this.extents.x=d,this.extents.y=g},this.draw=function(){b.noFill(),b.stroke(0,255,0),b.rectMode(k),b.rect(this.center.x+this.offset.x,this.center.y+this.offset.y,this.size().x/2,this.size().y/2)},this.overlap=function(a){if(a instanceof u){var b=a.minkowskiDifference(this);return b.min().x<=0&&b.max().x>=0&&b.min().y<=0&&b.max().y>=0}if(a instanceof t){var c=j(a.center.x,a.center.y);a.center.x<this.left()?c.x=this.left():a.center.x>this.right()&&(c.x=this.right()),a.center.y<this.top()?c.y=this.top():a.center.y>this.bottom()&&(c.y=this.bottom());return c.dist(a.center)<a.radius}},this.collide=function(a){if(a instanceof u){var c=a.minkowskiDifference(this);if(c.min().x<=0&&c.max().x>=0&&c.min().y<=0&&c.max().y>=0){return c.closestPointOnBoundsToPoint(j(0,0))}return j(0,0)}if(a instanceof t){var f=j(a.center.x,a.center.y);a.center.x<this.left()?f.x=this.left():a.center.x>this.right()&&(f.x=this.right()),a.center.y<this.top()?f.y=this.top():a.center.y>this.bottom()&&(f.y=this.bottom());var h,g=f.dist(a.center);if(g<a.radius){if(f.x===a.center.x&&f.y===a.center.y){var i=f.x-this.center.x,k=f.y-this.center.y;e(i)<e(k)?f.x=i>0?this.right():this.left():f.y=k<0?this.top():this.bottom(),h=b.atan2(a.center.y-f.y,a.center.x-f.x),0===h&&(f.x===this.right()&&(h=l),f.y===this.top()&&(h=l/2),f.y===this.bottom()&&(h=-l/2))}else h=b.atan2(f.y-a.center.y,f.x-a.center.x);var m=j(f.x-a.center.x,f.y-a.center.y);return j(b.cos(h)*a.radius-m.x,b.sin(h)*a.radius-m.y)}return j(0,0)}},this.minkowskiDifference=function(a){var c=this.min().sub(a.max()),d=this.size().add(a.size());return new u(b,c.add(d.div(2)),d.div(2))},this.closestPointOnBoundsToPoint=function(a){var b=e(a.x-this.min().x),c=j(this.min().x,a.y);return e(this.max().x-a.x)<b&&(b=e(this.max().x-a.x),c=j(this.max().x,a.y)),e(this.max().y-a.y)<b&&(b=e(this.max().y-a.y),c=j(a.x,this.max().y)),e(this.min().y-a.y)<b&&(b=e(this.min.y-a.y),c=j(a.x,this.min().y)),c}}function v(b){var d,c=Array.prototype.slice.call(arguments,1),e=a.prototype.CENTER;this.images=[];var g=0,h=0,i=-1;if(this.offX=0,this.offY=0,this.frameDelay=4,this.playing=!0,this.visible=!0,this.looping=!0,this.frameChanged=!1,this.imageCollider=!1,2===c.length&&"string"==typeof c[0]&&"string"==typeof c[1]){var j=c[0],k=c[1];".png"!==j.substring(j.length-4,j.length)&&(b.println("Animation error: you need to use .png files (filename "+j+")"),j=-1);if(".png"!==k.substring(k.length-4,k.length)&&(b.println("Animation error: you need to use .png files (filename "+k+")"),k=-1),-1!==j&&-1!==k){var n=0,o=0;for(d=j.length-5;d>=0;d--)j.charAt(d)>="0"&&j.charAt(d)<="9"&&n++;for(d=k.length-5;d>=0;d--)k.charAt(d)>="0"&&k.charAt(d)<="9"&&o++;var p=j.substring(0,j.length-(4+n)),q=k.substring(0,k.length-(4+o)),r=parseInt(j.substring(j.length-(4+n),j.length-4),10),s=parseInt(k.substring(k.length-(4+o),k.length-4),10);if(s<r){var t=s;s=r,r=t}if(p!==q)this.images.push(b.loadImage(j)),this.images.push(b.loadImage(k));else{var u;if(n===o)for(d=r;d<=s;d++)u=p+b.nf(d,n)+".png",this.images.push(b.loadImage(u));else for(d=r;d<=s;d++)u=p+d+".png",this.images.push(b.loadImage(u))}}}else if(1===c.length&&c[0]instanceof w)this.spriteSheet=c[0],this.images=this.spriteSheet.frames;else if(0!==c.length)for(d=0;d<c.length;d++)c[d]instanceof a.Image?this.images.push(c[d]):this.images.push(b.loadImage(c[d]));this.clone=function(){var a=new v(b);return a.images=[],this.spriteSheet&&(a.spriteSheet=this.spriteSheet.clone()),a.images=this.images.slice(),a.offX=this.offX,a.offY=this.offY,a.frameDelay=this.frameDelay,a.playing=this.playing,a.looping=this.looping,a},this.draw=function(a,c,d){if(this.xpos=a,this.ypos=c,this.rotation=d||0,this.visible){if(this.isSpriteAnimation||this.update(),b.push(),b.imageMode(e),b.translate(this.xpos,this.ypos),b._angleMode===b.RADIANS?b.rotate(f(this.rotation)):b.rotate(this.rotation),void 0!==this.images[g])if(this.spriteSheet){var h=this.images[g].frame;b.image(this.spriteSheet.image,h.x,h.y,h.width,h.height,this.offX,this.offY,h.width,h.height)}else b.image(this.images[g],this.offX,this.offY);else b.print("Warning undefined frame "+g);b.pop()}},this.update=function(){h++;var a=g;this.frameChanged=!1,1===this.images.length&&(this.playing=!1,g=0),this.playing&&h%this.frameDelay==0&&(i>g&&-1!==i?g++:i<g&&-1!==i?g--:i===g&&-1!==i?this.playing=!1:this.looping?g>=this.images.length-1?g=0:g++:g<this.images.length-1&&g++),a!==g&&(this.frameChanged=!0)},this.play=function(){this.playing=!0,i=-1},this.stop=function(){this.playing=!1},this.rewind=function(){g=0},this.changeFrame=function(a){g=a<this.images.length?a:this.images.length-1,i=-1},this.nextFrame=function(){g<this.images.length-1?g+=1:this.looping&&(g=0),i=-1,this.playing=!1},this.previousFrame=function(){g>0?g-=1:this.looping&&(g=this.images.length-1),i=-1,this.playing=!1},this.goToFrame=function(a){this.f=a,this.f>=0&&this.f<this.images.length&&(i=this.f),i!==g&&(this.playing=!0)},this.getFrame=function(){return g},this.getLastFrame=function(){return this.images.length-1},this.getFrameImage=function(){return this.images[g]},this.getImageAt=function(a){return this.images[a]},this.getWidth=function(){return this.images[g]instanceof a.Image?this.images[g].width:this.images[g]?this.images[g].frame.width:1},this.getHeight=function(){return this.images[g]instanceof a.Image?this.images[g].height:this.images[g]?this.images[g].frame.height:1}}function w(b){var c=Array.prototype.slice.call(arguments,1);this.image=null,this.frames=[],this.frame_width=0,this.frame_height=0,this.num_frames=0,this._generateSheetFrames=function(){for(var a=0,b=0,c=0;c<this.num_frames;c++)this.frames.push({name:c,frame:{x:a,y:b,width:this.frame_width,height:this.frame_height}}),(a+=this.frame_width)>=this.image.width&&(a=0,(b+=this.frame_height)>=this.image.height&&(b=0))},2===c.length&&Array.isArray(c[1])?(this.frames=c[1],this.num_frames=this.frames.length):4===c.length&&"number"==typeof c[1]&&"number"==typeof c[2]&&"number"==typeof c[3]&&(this.frame_width=c[1],this.frame_height=c[2],this.num_frames=c[3]),c[0]instanceof a.Image?(this.image=c[0],4===c.length&&this._generateSheetFrames()):2===c.length?this.image=b.loadImage(c[0]):4===c.length&&(this.image=b.loadImage(c[0],this._generateSheetFrames.bind(this))),this.drawFrame=function(a,c,d,e,f){var g;if("number"==typeof a)g=this.frames[a].frame;else for(var h=0;h<this.frames.length;h++)if(this.frames[h].name===a){g=this.frames[h].frame;break}var i=e||g.width,j=f||g.height;b.image(this.image,g.x,g.y,g.width,g.height,c,d,i,j)},this.clone=function(){for(var a=new w(b),c=0;c<this.frames.length;c++){var d=this.frames[c].frame,e={name:d.name,frame:{x:d.x,y:d.y,width:d.width,height:d.height}};a.frames.push(e)}return a.image=this.image,a.frame_width=this.frame_width,a.frame_height=this.frame_height,a.num_frames=this.num_frames,a}}function x(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c}function y(a,b,c,d){this.active=!0,this.max_objects=b||10,this.max_levels=c||4,this.level=d||0,this.bounds=a,this.objects=[],this.object_refs=[],this.nodes=[]}function z(){this.quadTree.active&&(this.quadTree.updateBounds(),this.quadTree.cleanup())}var e=a.prototype.abs,f=a.prototype.radians,g=a.prototype.dist,h=a.prototype.degrees,i=a.prototype.pow,j=a.prototype.round;b("allSprites",function(){return new a.prototype.Group}),a.prototype.spriteUpdate=!0,a.prototype.createSprite=function(a,b,c,d){var e=new o(this,a,b,c,d);return e.depth=this.allSprites.maxDepth()+1,this.allSprites.add(e),e},a.prototype.removeSprite=function(a){a.remove()},a.prototype.updateSprites=function(a){if(!1===a&&(this.spriteUpdate=!1),!0===a&&(this.spriteUpdate=!0),this.spriteUpdate)for(var b=0;b<this.allSprites.size();b++)this.allSprites.get(b).update()},a.prototype.getSprites=function(){if(0===arguments.length)return this.allSprites.toArray();for(var a=[],b=0;b<arguments.length;b++)for(var c=0;c<this.allSprites.size();c++)this.allSprites.get(c).isTagged(arguments[b])&&a.push(this.allSprites.get(c));return a},a.prototype.drawSprites=function(a){if(a=a||this.allSprites,"function"!=typeof a.draw)throw"Error: with drawSprites you can only draw all sprites or a group";a.draw()},a.prototype.drawSprite=function(a){a&&a.display()},a.prototype.loadAnimation=function(){return x(this.Animation,arguments)},a.prototype.loadSpriteSheet=function(){return x(this.SpriteSheet,arguments)},a.prototype.animation=function(a,b,c){a.draw(b,c)},b("_p5play",function(){return{keyStates:{},mouseStates:{}}});var k=0,l=1,m=2,n=3;a.prototype.keyWentDown=function(a){return this._isKeyInState(a,l)},a.prototype.keyWentUp=function(a){return this._isKeyInState(a,n)},a.prototype.keyDown=function(a){return this._isKeyInState(a,m)},a.prototype._isKeyInState=function(a,b){var c,d=this._p5play.keyStates;return c="string"==typeof a?this._keyCodeFromAlias(a):a,void 0===d[c]&&(this.keyIsDown(c)?d[c]=m:d[c]=k),d[c]===b},a.prototype.mouseDown=function(a){return this._isMouseButtonInState(a,m)},a.prototype.mouseUp=function(a){return this._isMouseButtonInState(a,k)},a.prototype.mouseWentUp=function(a){return this._isMouseButtonInState(a,n)},a.prototype.mouseWentDown=function(a){return this._isMouseButtonInState(a,l)},a.prototype._isMouseButtonInState=function(a,b){var c=this._p5play.mouseStates;return void 0===a&&(a=this.LEFT),void 0===c[a]&&(this.mouseIsPressed&&this.mouseButton===a?c[a]=m:c[a]=k),c[a]===b},a.prototype.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32," ":32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,LEFT:37,UP_ARROW:38,UP:38,RIGHT_ARROW:39,RIGHT:39,DOWN_ARROW:40,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0NUMPAD":96,"1NUMPAD":97,"2NUMPAD":98,"3NUMPAD":99,"4NUMPAD":100,"5NUMPAD":101,"6NUMPAD":102,"7NUMPAD":103,"8NUMPAD":104,"9NUMPAD":105,MULTIPLY:106,PLUS:107,MINUS:109,DOT:110,SLASH1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUAL:187,COMMA:188,SLASH:191,BACKSLASH:220},a.prototype.KEY_DEPRECATIONS={MINUT:"MINUS",COMA:"COMMA"},a.prototype._keyCodeFromAlias=function(a){return a=a.toUpperCase(),this.KEY_DEPRECATIONS[a]&&(this._warn('Key literal "'+a+'" is deprecated and may be removed in a future version of p5.play. Please use "'+this.KEY_DEPRECATIONS[a]+'" instead.'),a=this.KEY_DEPRECATIONS[a]),this.KEY[a]},a.prototype.readPresses=function(){var a=this._p5play.keyStates,b=this._p5play.mouseStates;for(var c in a)this.keyIsDown(c)?a[c]===k?a[c]=l:a[c]=m:a[c]===m?a[c]=n:a[c]=k;for(var d in b)this.mouseIsPressed&&this.mouseButton===d?b[d]===k?b[d]=l:b[d]=m:b[d]===m?b[d]=n:b[d]=k},a.prototype.useQuadTree=function(a){return void 0!==this.quadTree&&(void 0===a?this.quadTree.active:void(this.quadTree.active=!!a))},b("quadTree",function(){return new y({x:0,y:0,width:0,height:0},4)}),b("Sprite",c(o)),b("camera",function(){var a=new p(this,0,0,1);return a.init=!1,a}),b("Camera",c(p)),a.prototype.Group=s,b("CircleCollider",c(t)),b("AABB",c(u)),b("Animation",c(v)),b("SpriteSheet",c(w)),y.prototype.updateBounds=function(){for(var a=this.getAll(),b=1e4,c=1e4,d=-1e4,e=-1e4,f=0;f<a.length;f++)a[f].position.x<b&&(b=a[f].position.x),a[f].position.y<c&&(c=a[f].position.y),a[f].position.x>d&&(d=a[f].position.x),a[f].position.y>e&&(e=a[f].position.y);this.bounds={x:b,y:c,width:d,height:e}},y.prototype.split=function(){var a=this.level+1,b=Math.round(this.bounds.width/2),c=Math.round(this.bounds.height/2),d=Math.round(this.bounds.x),e=Math.round(this.bounds.y);this.nodes[0]=new y({x:d+b,y:e,width:b,height:c},this.max_objects,this.max_levels,a),this.nodes[1]=new y({x:d,y:e,width:b,height:c},this.max_objects,this.max_levels,a),this.nodes[2]=new y({x:d,y:e+c,width:b,height:c},this.max_objects,this.max_levels,a),this.nodes[3]=new y({x:d+b,y:e+c,width:b,height:c},this.max_objects,this.max_levels,a)},y.prototype.getIndex=function(a){if(a.collider){var b=-1,c=this.bounds.x+this.bounds.width/2,d=this.bounds.y+this.bounds.height/2,e=a.collider.top()<d&&a.collider.top()+a.collider.size().y<d,f=a.collider.top()>d;return a.collider.left()<c&&a.collider.left()+a.collider.size().x<c?e?b=1:f&&(b=2):a.collider.left()>c&&(e?b=0:f&&(b=3)),b}return-1},y.prototype.insert=function(a){if(-1===this.objects.indexOf(a)){var c,b=0;if(void 0!==this.nodes[0]&&-1!==(c=this.getIndex(a)))return void this.nodes[c].insert(a);if(this.objects.push(a),this.objects.length>this.max_objects&&this.level<this.max_levels)for(void 0===this.nodes[0]&&this.split();b<this.objects.length;)c=this.getIndex(this.objects[b]),-1!==c?this.nodes[c].insert(this.objects.splice(b,1)[0]):b+=1}},y.prototype.retrieve=function(a){var b=this.getIndex(a),c=this.objects;if(void 0!==this.nodes[0])if(-1!==b)c=c.concat(this.nodes[b].retrieve(a));else for(var d=0;d<this.nodes.length;d+=1)c=c.concat(this.nodes[d].retrieve(a));return c},y.prototype.retrieveFromGroup=function(a,b){for(var c=[],d=this.retrieve(a),e=0;e<d.length;e++)b.contains(d[e])&&c.push(d[e]);return c},y.prototype.getAll=function(){for(var a=this.objects,b=0;b<this.nodes.length;b+=1)a=a.concat(this.nodes[b].getAll());return a},y.prototype.getObjectNode=function(a){var b;if(!this.nodes.length)return this;if(-1===(b=this.getIndex(a)))return this;var c=this.nodes[b].getObjectNode(a);return c||!1},y.prototype.removeObject=function(a){var b=this.getObjectNode(a),c=b.objects.indexOf(a);if(-1===c)return!1;b.objects.splice(c,1)},y.prototype.clear=function(){if(this.objects=[],this.nodes.length){for(var a=0;a<this.nodes.length;a+=1)this.nodes[a].clear();this.nodes=[]}},y.prototype.cleanup=function(){var a=this.getAll();this.clear();for(var b=0;b<a.length;b++)this.insert(a[b])},a.prototype.registerMethod("pre",a.prototype.readPresses),a.prototype.registerMethod("pre",a.prototype.updateSprites),a.prototype.registerMethod("post",z),a.prototype.registerMethod("pre",q),a.prototype.registerMethod("post",r),a.prototype._warn=function(a){var b=window.console;b&&("function"==typeof b.warn?b.warn(a):"function"==typeof b.log&&b.log("Warning: "+a))}});